---
import { Image, type LocalImageProps } from 'astro:assets';
import TagBadge from './TagBadge.astro';

interface Props {
  slug: string;
  title: string;
  description: string;
  publishedDate: Date;
  readingTime: string;
  tags: string[];
  category: string;
  featuredImage?: LocalImageProps["src"];
  featured?: boolean;
}

const {
  slug,
  title,
  description,
  publishedDate,
  readingTime,
  tags,
  category,
  featuredImage,
  featured = false,
} = Astro.props;

const publishedDateLabel = new Intl.DateTimeFormat('en-US', {
  month: 'short',
  day: 'numeric',
  year: 'numeric',
}).format(publishedDate);

const categoryHref = `/blog?category=${encodeURIComponent(category)}`;
---

<article
  data-post-card
  data-title={title.toLowerCase()}
  data-description={description.toLowerCase()}
  data-category={category.toLowerCase()}
  data-tags={tags.map((tag) => tag.toLowerCase()).join(',')}
  class="group reading-surface grid overflow-hidden sm:grid-cols-[42%,1fr]"
>
  <a
    href={`/blog/${slug}/`}
    class="block h-full overflow-hidden"
    aria-label={`Read ${title}`}
  >
    {featuredImage ? (
      <Image
        src={featuredImage}
        alt={title}
        class="h-52 w-full object-cover transition duration-300 sm:h-full sm:min-h-[220px]"
        widths={[480, 720, 960]}
        sizes="(max-width: 640px) 100vw, (max-width: 1280px) 40vw, 420px"
        loading="lazy"
        format="webp"
      />
    ) : (
      <img
        src="/og-default.svg"
        alt={title}
        class="h-52 w-full object-cover transition duration-300 sm:h-full sm:min-h-[220px]"
        loading="lazy"
      />
    )}
  </a>

  <div class="space-y-4 p-6">
    <div class="flex flex-wrap items-center gap-3 text-sm text-slate-500 dark:text-slate-400">
      <time datetime={publishedDate.toISOString()}>{publishedDateLabel}</time>
      <span aria-hidden="true">â€¢</span>
      <span>{readingTime}</span>
      {featured && (
        <span class="rounded-full bg-sky-100 px-2 py-0.5 text-xs font-medium text-sky-700 dark:bg-sky-500/20 dark:text-sky-300">
          Featured
        </span>
      )}
    </div>

    <div class="space-y-2">
      <h3 class="text-2xl font-semibold leading-[1.2] tracking-tight text-slate-900 group-hover:text-sky-700 dark:text-slate-50 dark:group-hover:text-sky-300">
        <a href={`/blog/${slug}/`}>{title}</a>
      </h3>
      <p class="text-base leading-7 text-slate-600 dark:text-slate-300">{description}</p>
    </div>

    <div class="flex flex-wrap items-center gap-2">
      <a
        href={categoryHref}
        class="inline-flex items-center rounded-full border border-slate-300 px-3 py-1 text-xs font-medium text-slate-600 hover:border-sky-400 hover:text-sky-700 dark:border-slate-600 dark:text-slate-300 dark:hover:border-sky-400 dark:hover:text-sky-300"
      >
        {category}
      </a>
      {tags.map((tag) => (
        <TagBadge label={tag} href={`/blog?tag=${encodeURIComponent(tag)}`} />
      ))}
    </div>
  </div>
</article>
